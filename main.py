# -*- coding: utf-8 -*-
import logging
from datetime import datetime
import sqlite3
import io
import csv

from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

# üîê –¢–û–ö–ï–ù –¢–í–û–ï–ì–û –ë–û–¢–ê
API_TOKEN = "8502500500:AAHw3Nvkefvbff27oeuwjdPrF-lXRxboiKQ"

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN, parse_mode="HTML")
dp = Dispatcher(bot)

# ===== –ê–î–ú–ò–ù–´ (–ø–æ username –±–µ–∑ @) =====
ADMIN_USERNAMES = {"yusubovk", "DSharafeev_TVD"}  # –¥–æ–±–∞–≤–ª—è–µ—à—å –Ω–∏–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é


def is_admin(user: types.User) -> bool:
    return bool(user.username and user.username.lower() in ADMIN_USERNAMES)


# ===== –°–ü–ò–°–û–ö –ú–ê–†–ö–ï–¢–û–í –ß–ï–†–ï–ó –ú–ù–û–ì–û–°–¢–†–û–ß–ù–£–Æ –°–¢–†–û–ö–£ =====
MARKETS_TEXT = """
–ú–∞—Ä–∫–µ—Ç B-01
–ú–∞—Ä–∫–µ—Ç B-02
–ú–∞—Ä–∫–µ—Ç B-03
–ú–∞—Ä–∫–µ—Ç B-04
–ú–∞—Ä–∫–µ—Ç B-05
–ú–∞—Ä–∫–µ—Ç B-06
–ú–∞—Ä–∫–µ—Ç B-07
–ú–∞—Ä–∫–µ—Ç B-08
–ú–∞—Ä–∫–µ—Ç B-09
–ú–∞—Ä–∫–µ—Ç D-01
–ú–∞—Ä–∫–µ—Ç D-02
–ú–∞—Ä–∫–µ—Ç D-03
–ú–∞—Ä–∫–µ—Ç D-04
–ú–∞—Ä–∫–µ—Ç D-05
–ú–∞—Ä–∫–µ—Ç D-06
–ú–∞—Ä–∫–µ—Ç D-07
–ú–∞—Ä–∫–µ—Ç D-08
–ú–∞—Ä–∫–µ—Ç D-09
–ú–∞—Ä–∫–µ—Ç D-10
–ú–∞—Ä–∫–µ—Ç D-12
–ú–∞—Ä–∫–µ—Ç D-14
–ú–∞—Ä–∫–µ—Ç D-16
–ú–∞—Ä–∫–µ—Ç D-18
–ú–∞—Ä–∫–µ—Ç Dz-01
–ú–∞—Ä–∫–µ—Ç Dz-02
–ú–∞—Ä–∫–µ—Ç Dz-03
–ú–∞—Ä–∫–µ—Ç K-01
–ú–∞—Ä–∫–µ—Ç K-02
–ú–∞—Ä–∫–µ—Ç K-03
–ú–∞—Ä–∫–µ—Ç K-04
–ú–∞—Ä–∫–µ—Ç K-05
–ú–∞—Ä–∫–µ—Ç K-06
–ú–∞—Ä–∫–µ—Ç K-07
–ú–∞—Ä–∫–µ—Ç –ê-01
–ú–∞—Ä–∫–µ—Ç –ê-02
–ú–∞—Ä–∫–µ—Ç –ê-03
–ú–∞—Ä–∫–µ—Ç –ê-04
–ú–∞—Ä–∫–µ—Ç –ê-05
–ú–∞—Ä–∫–µ—Ç –ê-06
–ú–∞—Ä–∫–µ—Ç –ê-07
–ú–∞—Ä–∫–µ—Ç –ê-08
–ú–∞—Ä–∫–µ—Ç –ê-09
–ú–∞—Ä–∫–µ—Ç –ê-10
–ú–∞—Ä–∫–µ—Ç –ê-11
–ú–∞—Ä–∫–µ—Ç –ê-12
–ú–∞—Ä–∫–µ—Ç –ê-13
–ú–∞—Ä–∫–µ—Ç –ê-14
–ú–∞—Ä–∫–µ—Ç –ê-15
–ú–∞—Ä–∫–µ—Ç –ê-16
–ú–∞—Ä–∫–µ—Ç –ê-17
–ú–∞—Ä–∫–µ—Ç –ê-18
–ú–∞—Ä–∫–µ—Ç –ê-19
–ú–∞—Ä–∫–µ—Ç –ê-20
–ú–∞—Ä–∫–µ—Ç –ê-21
–ú–∞—Ä–∫–µ—Ç –ê-22
–ú–∞—Ä–∫–µ—Ç –ê-23
–ú–∞—Ä–∫–µ—Ç –ê-24
–ú–∞—Ä–∫–µ—Ç –ê-25
–ú–∞—Ä–∫–µ—Ç –ê-27
–ú–∞—Ä–∫–µ—Ç –ê-28
–ú–∞—Ä–∫–µ—Ç –ê-29
–ú–∞—Ä–∫–µ—Ç –ê-30
–ú–∞—Ä–∫–µ—Ç –ê-31
–ú–∞—Ä–∫–µ—Ç –ê-32
–ú–∞—Ä–∫–µ—Ç –ê-34
–ú–∞—Ä–∫–µ—Ç –ê-35
–ú–∞—Ä–∫–µ—Ç –ú-02
–ú–∞—Ä–∫–µ—Ç –ú-03
–ú–∞—Ä–∫–µ—Ç –ú-04
–ú–∞—Ä–∫–µ—Ç –ú-05
–ú–∞—Ä–∫–µ—Ç –ú-06
–ú–∞—Ä–∫–µ—Ç –ú-07
–ú–∞—Ä–∫–µ—Ç –ú-08
–ú–∞—Ä–∫–µ—Ç –ú-101
–ú–∞—Ä–∫–µ—Ç –ú-102
–ú–∞—Ä–∫–µ—Ç –ú-103
–ú–∞—Ä–∫–µ—Ç –ú-104
–ú–∞—Ä–∫–µ—Ç –ú-105
–ú–∞—Ä–∫–µ—Ç –ú-106
–ú–∞—Ä–∫–µ—Ç –ú-107
–ú–∞—Ä–∫–µ—Ç –ú-108
–ú–∞—Ä–∫–µ—Ç –ú-109
–ú–∞—Ä–∫–µ—Ç –ú-11
–ú–∞—Ä–∫–µ—Ç –ú-110
–ú–∞—Ä–∫–µ—Ç –ú-111
–ú–∞—Ä–∫–µ—Ç –ú-112
–ú–∞—Ä–∫–µ—Ç –ú-113
–ú–∞—Ä–∫–µ—Ç –ú-114
–ú–∞—Ä–∫–µ—Ç –ú-115
–ú–∞—Ä–∫–µ—Ç –ú-116
–ú–∞—Ä–∫–µ—Ç –ú-117
–ú–∞—Ä–∫–µ—Ç –ú-118
–ú–∞—Ä–∫–µ—Ç –ú-119
–ú–∞—Ä–∫–µ—Ç –ú-12
–ú–∞—Ä–∫–µ—Ç –ú-120
–ú–∞—Ä–∫–µ—Ç –ú-121
–ú–∞—Ä–∫–µ—Ç –ú-122
–ú–∞—Ä–∫–µ—Ç –ú-123
–ú–∞—Ä–∫–µ—Ç –ú-124
–ú–∞—Ä–∫–µ—Ç –ú-125
–ú–∞—Ä–∫–µ—Ç –ú-126
–ú–∞—Ä–∫–µ—Ç –ú-127
–ú–∞—Ä–∫–µ—Ç –ú-128
–ú–∞—Ä–∫–µ—Ç –ú-129
–ú–∞—Ä–∫–µ—Ç –ú-13
–ú–∞—Ä–∫–µ—Ç –ú-130
–ú–∞—Ä–∫–µ—Ç –ú-131
–ú–∞—Ä–∫–µ—Ç –ú-132
–ú–∞—Ä–∫–µ—Ç –ú-133
–ú–∞—Ä–∫–µ—Ç –ú-134
–ú–∞—Ä–∫–µ—Ç –ú-135
–ú–∞—Ä–∫–µ—Ç –ú-137
–ú–∞—Ä–∫–µ—Ç –ú-139
–ú–∞—Ä–∫–µ—Ç –ú-14
–ú–∞—Ä–∫–µ—Ç –ú-140
–ú–∞—Ä–∫–µ—Ç –ú-141
–ú–∞—Ä–∫–µ—Ç –ú-142
–ú–∞—Ä–∫–µ—Ç –ú-143
–ú–∞—Ä–∫–µ—Ç –ú-144
–ú–∞—Ä–∫–µ—Ç –ú-145
–ú–∞—Ä–∫–µ—Ç –ú-146
–ú–∞—Ä–∫–µ—Ç –ú-147
–ú–∞—Ä–∫–µ—Ç –ú-148
–ú–∞—Ä–∫–µ—Ç –ú-149
–ú–∞—Ä–∫–µ—Ç –ú-151
–ú–∞—Ä–∫–µ—Ç –ú-156
–ú–∞—Ä–∫–µ—Ç –ú-16
–ú–∞—Ä–∫–µ—Ç –ú-161
–ú–∞—Ä–∫–µ—Ç –ú-164
–ú–∞—Ä–∫–µ—Ç –ú-18
–ú–∞—Ä–∫–µ—Ç –ú-19
–ú–∞—Ä–∫–µ—Ç –ú-20
–ú–∞—Ä–∫–µ—Ç –ú-21
–ú–∞—Ä–∫–µ—Ç –ú-22
–ú–∞—Ä–∫–µ—Ç –ú-23
–ú–∞—Ä–∫–µ—Ç –ú-25
–ú–∞—Ä–∫–µ—Ç –ú-26
–ú–∞—Ä–∫–µ—Ç –ú-27
–ú–∞—Ä–∫–µ—Ç –ú-28
–ú–∞—Ä–∫–µ—Ç –ú-30
–ú–∞—Ä–∫–µ—Ç –ú-31
–ú–∞—Ä–∫–µ—Ç –ú-32
–ú–∞—Ä–∫–µ—Ç –ú-33
–ú–∞—Ä–∫–µ—Ç –ú-34
–ú–∞—Ä–∫–µ—Ç –ú-35
–ú–∞—Ä–∫–µ—Ç –ú-36
–ú–∞—Ä–∫–µ—Ç –ú-37
–ú–∞—Ä–∫–µ—Ç –ú-40
–ú–∞—Ä–∫–µ—Ç –ú-41
–ú–∞—Ä–∫–µ—Ç –ú-42
–ú–∞—Ä–∫–µ—Ç –ú-43
–ú–∞—Ä–∫–µ—Ç –ú-44
–ú–∞—Ä–∫–µ—Ç –ú-45
–ú–∞—Ä–∫–µ—Ç –ú-46
–ú–∞—Ä–∫–µ—Ç –ú-47
–ú–∞—Ä–∫–µ—Ç –ú-48
–ú–∞—Ä–∫–µ—Ç –ú-49
–ú–∞—Ä–∫–µ—Ç –ú-50
–ú–∞—Ä–∫–µ—Ç –ú-51
–ú–∞—Ä–∫–µ—Ç –ú-53
–ú–∞—Ä–∫–µ—Ç –ú-55
–ú–∞—Ä–∫–µ—Ç –ú-56
–ú–∞—Ä–∫–µ—Ç –ú-57
–ú–∞—Ä–∫–µ—Ç –ú-58
–ú–∞—Ä–∫–µ—Ç –ú-59
–ú–∞—Ä–∫–µ—Ç –ú-60
–ú–∞—Ä–∫–µ—Ç –ú-61
–ú–∞—Ä–∫–µ—Ç –ú-62
–ú–∞—Ä–∫–µ—Ç –ú-63
–ú–∞—Ä–∫–µ—Ç –ú-64
–ú–∞—Ä–∫–µ—Ç –ú-65
–ú–∞—Ä–∫–µ—Ç –ú-66
–ú–∞—Ä–∫–µ—Ç –ú-67
–ú–∞—Ä–∫–µ—Ç –ú-68
–ú–∞—Ä–∫–µ—Ç –ú-69
–ú–∞—Ä–∫–µ—Ç –ú-70
–ú–∞—Ä–∫–µ—Ç –ú-71
–ú–∞—Ä–∫–µ—Ç –ú-72
–ú–∞—Ä–∫–µ—Ç –ú-73
–ú–∞—Ä–∫–µ—Ç –ú-74
–ú–∞—Ä–∫–µ—Ç –ú-75
–ú–∞—Ä–∫–µ—Ç –ú-76
–ú–∞—Ä–∫–µ—Ç –ú-78
–ú–∞—Ä–∫–µ—Ç –ú-79
–ú–∞—Ä–∫–µ—Ç –ú-80
–ú–∞—Ä–∫–µ—Ç –ú-81
–ú–∞—Ä–∫–µ—Ç –ú-82
–ú–∞—Ä–∫–µ—Ç –ú-83
–ú–∞—Ä–∫–µ—Ç –ú-84
–ú–∞—Ä–∫–µ—Ç –ú-85
–ú–∞—Ä–∫–µ—Ç –ú-86
–ú–∞—Ä–∫–µ—Ç –ú-87
–ú–∞—Ä–∫–µ—Ç –ú-88
–ú–∞—Ä–∫–µ—Ç –ú-89
–ú–∞—Ä–∫–µ—Ç –ú-90
–ú–∞—Ä–∫–µ—Ç –ú-91
–ú–∞—Ä–∫–µ—Ç –ú-92
–ú–∞—Ä–∫–µ—Ç –ú-93
–ú–∞—Ä–∫–µ—Ç –ú-95
–ú–∞—Ä–∫–µ—Ç –ú-96
–ú–∞—Ä–∫–µ—Ç –ú-97
–ú–∞—Ä–∫–µ—Ç –ú-98
–ú–∞—Ä–∫–µ—Ç –ú-99
–ú–∞—Ä–∫–µ—Ç –°-01
–ú–∞—Ä–∫–µ—Ç –°-03
–ú–∞—Ä–∫–µ—Ç –°-04
–ú–∞—Ä–∫–µ—Ç –°-05
–ú–∞—Ä–∫–µ—Ç –°-06
–ú–∞—Ä–∫–µ—Ç –°-07
–ú–∞—Ä–∫–µ—Ç –°-08
–ú–∞—Ä–∫–µ—Ç –°-09
–ú–∞—Ä–∫–µ—Ç –°-10
–ú–∞—Ä–∫–µ—Ç –°-11
–ú–∞—Ä–∫–µ—Ç –°-12
–ú–∞—Ä–∫–µ—Ç –°-13
–ú–∞—Ä–∫–µ—Ç –°-14
–ú–∞—Ä–∫–µ—Ç –°-15
–ú–∞—Ä–∫–µ—Ç –°-16–¢
–ú–∞—Ä–∫–µ—Ç –°-17
–ú–∞—Ä–∫–µ—Ç –°-18
–ú–∞—Ä–∫–µ—Ç –°-19
–ú–∞—Ä–∫–µ—Ç –°-20
–ú–∞—Ä–∫–µ—Ç –°-21
–ú–∞—Ä–∫–µ—Ç –°-22
–ú–∞—Ä–∫–µ—Ç –°-27
–ú–∞—Ä–∫–µ—Ç –ú-153
–ú–∞—Ä–∫–µ—Ç D-17
–ú–∞—Ä–∫–µ—Ç D-15
–ú–∞—Ä–∫–µ—Ç –°-23
–ú–∞—Ä–∫–µ—Ç –ê-37
–ú–∞—Ä–∫–µ—Ç S-01
–ú–∞—Ä–∫–µ—Ç S-03
–ú–∞—Ä–∫–µ—Ç S-06
–ú–∞—Ä–∫–µ—Ç S-09
–ú–∞—Ä–∫–µ—Ç –°-25
–ú–∞—Ä–∫–µ—Ç Dz-04
"""

MARKETS = [line.strip() for line in MARKETS_TEXT.splitlines() if line.strip()]

# ===== –ì–†–£–ü–ü–ò–†–û–í–ö–ê –ú–ê–†–ö–ï–¢–û–í –ü–û –ë–£–ö–í–ï/–ö–û–î–£ =====
from collections import defaultdict

MARKET_GROUPS = defaultdict(list)
for m in MARKETS:
    code = m.replace("–ú–∞—Ä–∫–µ—Ç", "").strip()  # "B-01", "Dz-01", "–ê-01"
    prefix = code.split('-')[0].strip()     # "B", "Dz", "–ê"
