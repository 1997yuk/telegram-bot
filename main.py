# -*- coding: utf-8 -*-
import logging
from aiogram import Bot, Dispatcher, types
from datetime import datetime

# üîê –¢–í–û–ô –¢–û–ö–ï–ù –ë–û–¢–ê
API_TOKEN = "8502500500:AAHw3Nvkefvbff27oeuwjdPrF-lXRxboiKQ"

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# ===== –°–ü–ò–°–û–ö –ú–ê–†–ö–ï–¢–û–í =====
MARKETS = [
    "–ú–∞—Ä–∫–µ—Ç B-01",
    "–ú–∞—Ä–∫–µ—Ç B-02",
    "–ú–∞—Ä–∫–µ—Ç B-03",
    "–ú–∞—Ä–∫–µ—Ç B-04",
    "–ú–∞—Ä–∫–µ—Ç B-05",
    "–ú–∞—Ä–∫–µ—Ç B-06",
    "–ú–∞—Ä–∫–µ—Ç B-07",
    "–ú–∞—Ä–∫–µ—Ç B-08",
    "–ú–∞—Ä–∫–µ—Ç B-09",
    "–ú–∞—Ä–∫–µ—Ç D-01",
    "–ú–∞—Ä–∫–µ—Ç D-02",
    "–ú–∞—Ä–∫–µ—Ç D-03",
    "–ú–∞—Ä–∫–µ—Ç D-04",
    "–ú–∞—Ä–∫–µ—Ç D-05",
    "–ú–∞—Ä–∫–µ—Ç D-06",
    "–ú–∞—Ä–∫–µ—Ç D-07",
    "–ú–∞—Ä–∫–µ—Ç D-08",
    "–ú–∞—Ä–∫–µ—Ç D-09",
    "–ú–∞—Ä–∫–µ—Ç D-10",
    "–ú–∞—Ä–∫–µ—Ç D-12",
    "–ú–∞—Ä–∫–µ—Ç D-14",
    "–ú–∞—Ä–∫–µ—Ç D-16",
    "–ú–∞—Ä–∫–µ—Ç D-18",
    "–ú–∞—Ä–∫–µ—Ç Dz-01",
    "–ú–∞—Ä–∫–µ—Ç Dz-02",
    "–ú–∞—Ä–∫–µ—Ç Dz-03",
    "–ú–∞—Ä–∫–µ—Ç K-01",
    "–ú–∞—Ä–∫–µ—Ç K-02",
    "–ú–∞—Ä–∫–µ—Ç K-03",
    "–ú–∞—Ä–∫–µ—Ç K-04",
    "–ú–∞—Ä–∫–µ—Ç K-05",
    "–ú–∞—Ä–∫–µ—Ç K-06",
    "–ú–∞—Ä–∫–µ—Ç K-07",
    "–ú–∞—Ä–∫–µ—Ç –ê-01",
    "–ú–∞—Ä–∫–µ—Ç –ê-02",
    "–ú–∞—Ä–∫–µ—Ç –ê-03",
    "–ú–∞—Ä–∫–µ—Ç –ê-04",
    "–ú–∞—Ä–∫–µ—Ç –ê-05",
    "–ú–∞—Ä–∫–µ—Ç –ê-06",
    "–ú–∞—Ä–∫–µ—Ç –ê-07",
    "–ú–∞—Ä–∫–µ—Ç –ê-08",
    "–ú–∞—Ä–∫–µ—Ç –ê-09",
    "–ú–∞—Ä–∫–µ—Ç –ê-10",
    "–ú–∞—Ä–∫–µ—Ç –ê-11",
    "–ú–∞—Ä–∫–µ—Ç –ê-12",
    "–ú–∞—Ä–∫–µ—Ç –ê-13",
    "–ú–∞—Ä–∫–µ—Ç –ê-14",
    "–ú–∞—Ä–∫–µ—Ç –ê-15",
    "–ú–∞—Ä–∫–µ—Ç –ê-16",
    "–ú–∞—Ä–∫–µ—Ç –ê-17",
    "–ú–∞—Ä–∫–µ—Ç –ê-18",
    "–ú–∞—Ä–∫–µ—Ç –ê-19",
    "–ú–∞—Ä–∫–µ—Ç –ê-20",
    "–ú–∞—Ä–∫–µ—Ç –ê-21",
    "–ú–∞—Ä–∫–µ—Ç –ê-22",
    "–ú–∞—Ä–∫–µ—Ç –ê-23",
    "–ú–∞—Ä–∫–µ—Ç –ê-24",
    "–ú–∞—Ä–∫–µ—Ç –ê-25",
    "–ú–∞—Ä–∫–µ—Ç –ê-27",
    "–ú–∞—Ä–∫–µ—Ç –ê-28",
    "–ú–∞—Ä–∫–µ—Ç –ê-29",
    "–ú–∞—Ä–∫–µ—Ç –ê-30",
    "–ú–∞—Ä–∫–µ—Ç –ê-31",
    "–ú–∞—Ä–∫–µ—Ç –ê-32",
    "–ú–∞—Ä–∫–µ—Ç –ê-34",
    "–ú–∞—Ä–∫–µ—Ç –ê-35",
    "–ú–∞—Ä–∫–µ—Ç –ú-02",
    "–ú–∞—Ä–∫–µ—Ç –ú-03",
    "–ú–∞—Ä–∫–µ—Ç –ú-04",
    "–ú–∞—Ä–∫–µ—Ç –ú-05",
    "–ú–∞—Ä–∫–µ—Ç –ú-06",
    "–ú–∞—Ä–∫–µ—Ç –ú-07",
    "–ú–∞—Ä–∫–µ—Ç –ú-08",
    "–ú–∞—Ä–∫–µ—Ç –ú-101",
    "–ú–∞—Ä–∫–µ—Ç –ú-102",
    "–ú–∞—Ä–∫–µ—Ç –ú-103",
    "–ú–∞—Ä–∫–µ—Ç –ú-104",
    "–ú–∞—Ä–∫–µ—Ç –ú-105",
    "–ú–∞—Ä–∫–µ—Ç –ú-106",
    "–ú–∞—Ä–∫–µ—Ç –ú-107",
    "–ú–∞—Ä–∫–µ—Ç –ú-108",
    "–ú–∞—Ä–∫–µ—Ç –ú-109",
    "–ú–∞—Ä–∫–µ—Ç –ú-11",
    "–ú–∞—Ä–∫–µ—Ç –ú-110",
    "–ú–∞—Ä–∫–µ—Ç –ú-111",
    "–ú–∞—Ä–∫–µ—Ç –ú-112",
    "–ú–∞—Ä–∫–µ—Ç –ú-113",
    "–ú–∞—Ä–∫–µ—Ç –ú-114",
    "–ú–∞—Ä–∫–µ—Ç –ú-115",
    "–ú–∞—Ä–∫–µ—Ç –ú-116",
    "–ú–∞—Ä–∫–µ—Ç –ú-117",
    "–ú–∞—Ä–∫–µ—Ç –ú-118",
    "–ú–∞—Ä–∫–µ—Ç –ú-119",
    "–ú–∞—Ä–∫–µ—Ç –ú-12",
    "–ú–∞—Ä–∫–µ—Ç –ú-120",
    "–ú–∞—Ä–∫–µ—Ç –ú-121",
    "–ú–∞—Ä–∫–µ—Ç –ú-122",
    "–ú–∞—Ä–∫–µ—Ç –ú-123",
    "–ú–∞—Ä–∫–µ—Ç –ú-124",
    "–ú–∞—Ä–∫–µ—Ç –ú-125",
    "–ú–∞—Ä–∫–µ—Ç –ú-126",
    "–ú–∞—Ä–∫–µ—Ç –ú-127",
    "–ú–∞—Ä–∫–µ—Ç –ú-128",
    "–ú–∞—Ä–∫–µ—Ç –ú-129",
    "–ú–∞—Ä–∫–µ—Ç –ú-13",
    "–ú–∞—Ä–∫–µ—Ç –ú-130",
    "–ú–∞—Ä–∫–µ—Ç –ú-131",
    "–ú–∞—Ä–∫–µ—Ç –ú-132",
    "–ú–∞—Ä–∫–µ—Ç –ú-133",
    "–ú–∞—Ä–∫–µ—Ç –ú-134",
    "–ú–∞—Ä–∫–µ—Ç –ú-135",
    "–ú–∞—Ä–∫–µ—Ç –ú-137",
    "–ú–∞—Ä–∫–µ—Ç –ú-139",
    "–ú–∞—Ä–∫–µ—Ç –ú-14",
    "–ú–∞—Ä–∫–µ—Ç –ú-140",
    "–ú–∞—Ä–∫–µ—Ç –ú-141",
    "–ú–∞—Ä–∫–µ—Ç –ú-142",
    "–ú–∞—Ä–∫–µ—Ç –ú-143",
    "–ú–∞—Ä–∫–µ—Ç –ú-144",
    "–ú–∞—Ä–∫–µ—Ç –ú-145",
    "–ú–∞—Ä–∫–µ—Ç –ú-146",
    "–ú–∞—Ä–∫–µ—Ç –ú-147",
    "–ú–∞—Ä–∫–µ—Ç –ú-148",
    "–ú–∞—Ä–∫–µ—Ç –ú-149",
    "–ú–∞—Ä–∫–µ—Ç –ú-151",
    "–ú–∞—Ä–∫–µ—Ç –ú-156",
    "–ú–∞—Ä–∫–µ—Ç –ú-16",
    "–ú–∞—Ä–∫–µ—Ç –ú-161",
    "–ú–∞—Ä–∫–µ—Ç –ú-164",
    "–ú–∞—Ä–∫–µ—Ç –ú-18",
    "–ú–∞—Ä–∫–µ—Ç –ú-19",
    "–ú–∞—Ä–∫–µ—Ç –ú-20",
    "–ú–∞—Ä–∫–µ—Ç –ú-21",
    "–ú–∞—Ä–∫–µ—Ç –ú-22",
    "–ú–∞—Ä–∫–µ—Ç –ú-23",
    "–ú–∞—Ä–∫–µ—Ç –ú-25",
    "–ú–∞—Ä–∫–µ—Ç –ú-26",
    "–ú–∞—Ä–∫–µ—Ç –ú-27",
    "–ú–∞—Ä–∫–µ—Ç –ú-28",
    "–ú–∞—Ä–∫–µ—Ç –ú-30",
    "–ú–∞—Ä–∫–µ—Ç –ú-31",
    "–ú–∞—Ä–∫–µ—Ç –ú-32",
    "–ú–∞—Ä–∫–µ—Ç –ú-33",
    "–ú–∞—Ä–∫–µ—Ç –ú-34",
    "–ú–∞—Ä–∫–µ—Ç –ú-35",
    "–ú–∞—Ä–∫–µ—Ç –ú-36",
    "–ú–∞—Ä–∫–µ—Ç –ú-37",
    "–ú–∞—Ä–∫–µ—Ç –ú-40",
    "–ú–∞—Ä–∫–µ—Ç –ú-41",
    "–ú–∞—Ä–∫–µ—Ç –ú-42",
    "–ú–∞—Ä–∫–µ—Ç –ú-43",
    "–ú–∞—Ä–∫–µ—Ç –ú-44",
    "–ú–∞—Ä–∫–µ—Ç –ú-45",
    "–ú–∞—Ä–∫–µ—Ç –ú-46",
    "–ú–∞—Ä–∫–µ—Ç –ú-47",
    "–ú–∞—Ä–∫–µ—Ç –ú-48",
    "–ú–∞—Ä–∫–µ—Ç –ú-49",
    "–ú–∞—Ä–∫–µ—Ç –ú-50",
    "–ú–∞—Ä–∫–µ—Ç –ú-51",
    "–ú–∞—Ä–∫–µ—Ç –ú-53",
    "–ú–∞—Ä–∫–µ—Ç –ú-55",
    "–ú–∞—Ä–∫–µ—Ç –ú-56",
    "–ú–∞—Ä–∫–µ—Ç –ú-57",
    "–ú–∞—Ä–∫–µ—Ç –ú-58",
    "–ú–∞—Ä–∫–µ—Ç –ú-59",
    "–ú–∞—Ä–∫–µ—Ç –ú-60",
    "–ú–∞—Ä–∫–µ—Ç –ú-61",
    "–ú–∞—Ä–∫–µ—Ç –ú-62",
    "–ú–∞—Ä–∫–µ—Ç –ú-63",
    "–ú–∞—Ä–∫–µ—Ç –ú-64",
    "–ú–∞—Ä–∫–µ—Ç –ú-65",
    "–ú–∞—Ä–∫–µ—Ç –ú-66",
    "–ú–∞—Ä–∫–µ—Ç –ú-67",
    "–ú–∞—Ä–∫–µ—Ç –ú-68",
    "–ú–∞—Ä–∫–µ—Ç –ú-69",
    "–ú–∞—Ä–∫–µ—Ç –ú-70",
    "–ú–∞—Ä–∫–µ—Ç –ú-71",
    "–ú–∞—Ä–∫–µ—Ç –ú-72",
    "–ú–∞—Ä–∫–µ—Ç –ú-73",
    "–ú–∞—Ä–∫–µ—Ç –ú-74",
    "–ú–∞—Ä–∫–µ—Ç –ú-75",
    "–ú–∞—Ä–∫–µ—Ç –ú-76",
    "–ú–∞—Ä–∫–µ—Ç –ú-78",
    "–ú–∞—Ä–∫–µ—Ç –ú-79",
    "–ú–∞—Ä–∫–µ—Ç –ú-80",
    "–ú–∞—Ä–∫–µ—Ç –ú-81",
    "–ú–∞—Ä–∫–µ—Ç –ú-82",
    "–ú–∞—Ä–∫–µ—Ç –ú-83",
    "–ú–∞—Ä–∫–µ—Ç –ú-84",
    "–ú–∞—Ä–∫–µ—Ç –ú-85",
    "–ú–∞—Ä–∫–µ—Ç –ú-86",
    "–ú–∞—Ä–∫–µ—Ç –ú-87",
    "–ú–∞—Ä–∫–µ—Ç –ú-88",
    "–ú–∞—Ä–∫–µ—Ç –ú-89",
    "–ú–∞—Ä–∫–µ—Ç –ú-90",
    "–ú–∞—Ä–∫–µ—Ç –ú-91",
    "–ú–∞—Ä–∫–µ—Ç –ú-92",
    "–ú–∞—Ä–∫–µ—Ç –ú-93",
    "–ú–∞—Ä–∫–µ—Ç –ú-95",
    "–ú–∞—Ä–∫–µ—Ç –ú-96",
    "–ú–∞—Ä–∫–µ—Ç –ú-97",
    "–ú–∞—Ä–∫–µ—Ç –ú-98",
    "–ú–∞—Ä–∫–µ—Ç –ú-99",
    "–ú–∞—Ä–∫–µ—Ç –°-01",
    "–ú–∞—Ä–∫–µ—Ç –°-03",
    "–ú–∞—Ä–∫–µ—Ç –°-04",
    "–ú–∞—Ä–∫–µ—Ç –°-05",
    "–ú–∞—Ä–∫–µ—Ç –°-06",
    "–ú–∞—Ä–∫–µ—Ç –°-07",
    "–ú–∞—Ä–∫–µ—Ç –°-08",
    "–ú–∞—Ä–∫–µ—Ç –°-09",
    "–ú–∞—Ä–∫–µ—Ç –°-10",
    "–ú–∞—Ä–∫–µ—Ç –°-11",
    "–ú–∞—Ä–∫–µ—Ç –°-12",
    "–ú–∞—Ä–∫–µ—Ç –°-13",
    "–ú–∞—Ä–∫–µ—Ç –°-14",
    "–ú–∞—Ä–∫–µ—Ç –°-15",
    "–ú–∞—Ä–∫–µ—Ç –°-16–¢",
    "–ú–∞—Ä–∫–µ—Ç –°-17",
    "–ú–∞—Ä–∫–µ—Ç –°-18",
    "–ú–∞—Ä–∫–µ—Ç –°-19",
    "–ú–∞—Ä–∫–µ—Ç –°-20",
    "–ú–∞—Ä–∫–µ—Ç –°-21",
    "–ú–∞—Ä–∫–µ—Ç –°-22",
    "–ú–∞—Ä–∫–µ—Ç –°-27",
    "–ú–∞—Ä–∫–µ—Ç –ú-153",
    "–ú–∞—Ä–∫–µ—Ç D-17",
    "–ú–∞—Ä–∫–µ—Ç D-15",
    "–ú–∞—Ä–∫–µ—Ç –°-23",
    "–ú–∞—Ä–∫–µ—Ç –ê-37",
    "–ú–∞—Ä–∫–µ—Ç S-01",
    "–ú–∞—Ä–∫–µ—Ç S-03",
    "–ú–∞—Ä–∫–µ—Ç S-06",
    "–ú–∞—Ä–∫–µ—Ç S-09",
    "–ú–∞—Ä–∫–µ—Ç –°-25",
    "–ú–∞—Ä–∫–µ—Ç Dz-04",
]

# –°–∫–æ–ª—å–∫–æ –º–∞—Ä–∫–µ—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–π "—Å—Ç—Ä–∞–Ω–∏—Ü–µ" –º–µ–Ω—é
PAGE_SIZE = 10

# user_id -> –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ç–∞ (–∫–∞–∫–æ–π –º–∞—Ä–∫–µ—Ç –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
user_market = {}

# –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ç–∞ -> –æ—Ç—á–∏—Ç–∞–ª—Å—è (True/False) –∑–∞ —Å–µ–≥–æ–¥–Ω—è
daily_reports = {}
current_date = None


def reset_reports():
    """–°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤."""
    global daily_reports, current_date
    current_date = datetime.now().date()
    daily_reports = {name: False for name in MARKETS}


reset_reports()


def make_markets_keyboard(page: int = 0) -> types.InlineKeyboardMarkup:
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –≤—ã–±–æ—Ä–æ–º –º–∞—Ä–∫–µ—Ç–∞, –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ.
    page = 0,1,2,...
    """
    kb = types.InlineKeyboardMarkup(row_width=1)

    start = page * PAGE_SIZE
    end = start + PAGE_SIZE

    # –∫–Ω–æ–ø–∫–∏ –º–∞—Ä–∫–µ—Ç–æ–≤
    for name in MARKETS[start:end]:
        kb.add(
            types.InlineKeyboardButton(
                text=name,
                callback_data=f"market:{name}",
            )
        )

    # –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    nav_buttons = []
    if page > 0:
        nav_buttons.append(
            types.InlineKeyboardButton(
                text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"page:{page-1}"
            )
        )
    if end < len(MARKETS):
        nav_buttons.append(
            types.InlineKeyboardButton(
                text="–í–ø–µ—Ä—ë–¥ ‚û°Ô∏è", callback_data=f"page:{page+1}"
            )
        )
    if nav_buttons:
        kb.row(*nav_buttons)

    return kb


@dp.message_handler(commands=["start", "help"])
async def cmd_start(message: types.Message):
    """–°—Ç–∞—Ä—Ç: –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å –º–∞—Ä–∫–µ—Ç, –µ—Å–ª–∏ –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–Ω."""
    user_id = message.from_user.id

    if user_id in user_market:
        await message.reply(
            f"–ü—Ä–∏–≤–µ—Ç! –¢—ã —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –º–∞—Ä–∫–µ—Ç–∞: {user_market[user_id]}\n"
            "–ú–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ñ–æ—Ç–æ –≤ —Ä–∞–±–æ—á—É—é –≥—Ä—É–ø–ø—É.\n\n"
            "–ö–æ–º–∞–Ω–¥—ã:\n"
            "/status ‚Äì —Å—Ç–∞—Ç—É—Å –æ—Ç—á—ë—Ç–æ–≤\n"
            "/reset ‚Äì –æ–±–Ω—É–ª–∏—Ç—å –æ—Ç—á—ë—Ç—ã (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)"
        )
    else:
        await message.reply(
            "–ü—Ä–∏–≤–µ—Ç! –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Å–≤–æ–π –º–∞—Ä–∫–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:",
            reply_markup=make_markets_keyboard(page=0),
        )


# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –º–µ–Ω—é –º–∞—Ä–∫–µ—Ç–æ–≤
@dp.callback_query_handler(lambda c: c.data.startswith("page:"))
async def process_page_callback(callback_query: types.CallbackQuery):
    page = int(callback_query.data.split(":", 1)[1])
    await callback_query.message.edit_reply_markup(
        make_markets_keyboard(page=page)
    )
    await callback_query.answer()


# –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∞
@dp.callback_query_handler(lambda c: c.data.startswith("market:"))
async def process_market_callback(callback_query: types.CallbackQuery):
    user_id = callback_query.from_user.id
    market_name = callback_query.data.split(":", 1)[1]

    user_market[user_id] = market_name

    # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –¥–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ç –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫,
    # –µ—Å–ª–∏ –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Å–ø–∏—Å–æ–∫ MARKETS –ø–æ–º–µ–Ω—è–µ—Ç—Å—è
    if market_name not in daily_reports:
        daily_reports[market_name] = False

    await callback_query.message.edit_text(
        f"–ú–∞—Ä–∫–µ—Ç –≤—ã–±—Ä–∞–Ω: {market_name}.\n"
        "–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ñ–æ—Ç–æ –≤ —Ä–∞–±–æ—á—É—é –≥—Ä—É–ø–ø—É."
    )
    await callback_query.answer("–ú–∞—Ä–∫–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!")


@dp.message_handler(commands=["reset"])
async def cmd_reset(message: types.Message):
    """–û–±–Ω—É–ª–∏—Ç—å –æ—Ç—á—ë—Ç—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º)."""
    reset_reports()
    await message.answer("–û—Ç—á—ë—Ç—ã –æ–±–Ω—É–ª–µ–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. –ñ–¥—É —Ñ–æ—Ç–æ –æ—Ç –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ç–æ–≤.")


@dp.message_handler(commands=["status"])
async def cmd_status(message: types.Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –º–∞—Ä–∫–µ—Ç—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ñ–æ—Ç–æ, –∞ –∫–∞–∫–∏–µ –Ω–µ—Ç."""
    global current_date
    today = datetime.now().date()
    if current_date != today:
        reset_reports()

    done = []
    not_done = []

    for name in MARKETS:
        if daily_reports.get(name):
            done.append(f"‚úÖ {name}")
        else:
            not_done.append(f"‚ùå {name}")

    text = "–°—Ç–∞—Ç—É—Å –æ—Ç—á—ë—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n\n"
    if done:
        text += "–û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ñ–æ—Ç–æ:\n" + "\n".join(done) + "\n\n"
    else:
        text += "–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–æ—Ç–æ.\n\n"

    if not_done:
        text += "–ï—â—ë –ù–ï –æ—Ç–ø—Ä–∞–≤–∏–ª–∏:\n" + "\n".join(not_done)
    else:
        text += "–í—Å–µ –º–∞—Ä–∫–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ñ–æ—Ç–æ. üëç"

    await message.answer(text)


@dp.message_handler(content_types=types.ContentType.PHOTO)
async def handle_photo(message: types.Message):
    """
    –õ—é–±–æ–µ —Ñ–æ—Ç–æ ‚Äì –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç—á—ë—Ç–∞ –º–∞—Ä–∫–µ—Ç–∞.
    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞—Ç—å —Å–≤–æ–π –º–∞—Ä–∫–µ—Ç —á–µ—Ä–µ–∑ /start.
    """
    global current_date
    today = datetime.now().date()
    if current_date != today:
        reset_reports()

    user_id = message.from_user.id

    if user_id not in user_market:
        await message.reply(
            "–¢—ã –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–ª —Å–≤–æ–π –º–∞—Ä–∫–µ—Ç. –ù–∞–∂–º–∏ /start –∏ –≤—ã–±–µ—Ä–∏ –µ–≥–æ –∏–∑ —Å–ø–∏—Å–∫–∞."
        )
        return

    market_name = user_market[user_id]
    daily_reports[market_name] = True

    await message.reply(
        f"–§–æ—Ç–æ –ø—Ä–∏–Ω—è—Ç–æ. {market_name} –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏–≤—à–∏–π ‚úÖ"
    )


if __name__ == "__main__":
    from aiogram import executor
    executor.start_polling(dp, skip_updates=True)
