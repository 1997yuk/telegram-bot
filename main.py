# -*- coding: utf-8 -*-
import logging
from datetime import datetime
import sqlite3
import io
import csv
import json

from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, WebAppInfo

# üîê –¢–û–ö–ï–ù –¢–í–û–ï–ì–û –ë–û–¢–ê
API_TOKEN = "8502500500:AAHw3Nvkefvbff27oeuwjdPrF-lXRxboiKQ"

# üîó URL —Ç–≤–æ–µ–≥–æ WebApp –Ω–∞ GitHub Pages
WEBAPP_URL = "https://1997yuk.github.io/telegram-bot/index.html"  # !!! –ó–ê–ú–ï–ù–ò !!!

# üîó ID –≥—Ä—É–ø–ø—ã, –∫—É–¥–∞ –±–æ—Ç –±—É–¥–µ—Ç –≤—ã–∫–ª–∞–¥—ã–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç
# –ù–∞–ø—Ä–∏–º–µ—Ä: TARGET_GROUP_ID = -1001234567890
TARGET_GROUP_ID = -1003247828545  # !!! –ó–ê–ú–ï–ù–ò –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π chat_id –≥—Ä—É–ø–ø—ã !!!

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN, parse_mode="HTML")
dp = Dispatcher(bot)

# ===== –ê–î–ú–ò–ù–´ (–ø–æ username –±–µ–∑ @) =====
ADMIN_USERNAMES = {"yusubovk"}  # –¥–æ–±–∞–≤–ª—è–π –Ω–∏–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é


def is_admin(user: types.User) -> bool:
    return bool(user.username and user.username.lower() in ADMIN_USERNAMES)


# ===== –°–ü–ò–°–û–ö –ú–ê–†–ö–ï–¢–û–í =====
MARKETS = [
    "–ú–∞—Ä–∫–µ—Ç B-01", "–ú–∞—Ä–∫–µ—Ç B-02", "–ú–∞—Ä–∫–µ—Ç B-03", "–ú–∞—Ä–∫–µ—Ç B-04", "–ú–∞—Ä–∫–µ—Ç B-05",
    "–ú–∞—Ä–∫–µ—Ç B-06", "–ú–∞—Ä–∫–µ—Ç B-07", "–ú–∞—Ä–∫–µ—Ç B-08", "–ú–∞—Ä–∫–µ—Ç B-09",
    "–ú–∞—Ä–∫–µ—Ç D-01", "–ú–∞—Ä–∫–µ—Ç D-02", "–ú–∞—Ä–∫–µ—Ç D-03", "–ú–∞—Ä–∫–µ—Ç D-04", "–ú–∞—Ä–∫–µ—Ç D-05",
    "–ú–∞—Ä–∫–µ—Ç D-06", "–ú–∞—Ä–∫–µ—Ç D-07", "–ú–∞—Ä–∫–µ—Ç D-08", "–ú–∞—Ä–∫–µ—Ç D-09", "–ú–∞—Ä–∫–µ—Ç D-10",
    "–ú–∞—Ä–∫–µ—Ç D-12", "–ú–∞—Ä–∫–µ—Ç D-14", "–ú–∞—Ä–∫–µ—Ç D-16", "–ú–∞—Ä–∫–µ—Ç D-18",
    "–ú–∞—Ä–∫–µ—Ç Dz-01", "–ú–∞—Ä–∫–µ—Ç Dz-02", "–ú–∞—Ä–∫–µ—Ç Dz-03", "–ú–∞—Ä–∫–µ—Ç Dz-04",
    "–ú–∞—Ä–∫–µ—Ç K-01", "–ú–∞—Ä–∫–µ—Ç K-02", "–ú–∞—Ä–∫–µ—Ç K-03", "–ú–∞—Ä–∫–µ—Ç K-04", "–ú–∞—Ä–∫–µ—Ç K-05",
    "–ú–∞—Ä–∫–µ—Ç K-06", "–ú–∞—Ä–∫–µ—Ç K-07",
    "–ú–∞—Ä–∫–µ—Ç –ê-01", "–ú–∞—Ä–∫–µ—Ç –ê-02", "–ú–∞—Ä–∫–µ—Ç –ê-03", "–ú–∞—Ä–∫–µ—Ç –ê-04", "–ú–∞—Ä–∫–µ—Ç –ê-05",
    "–ú–∞—Ä–∫–µ—Ç –ê-06", "–ú–∞—Ä–∫–µ—Ç –ê-07", "–ú–∞—Ä–∫–µ—Ç –ê-08", "–ú–∞—Ä–∫–µ—Ç –ê-09", "–ú–∞—Ä–∫–µ—Ç –ê-10",
    "–ú–∞—Ä–∫–µ—Ç –ê-11", "–ú–∞—Ä–∫–µ—Ç –ê-12", "–ú–∞—Ä–∫–µ—Ç –ê-13", "–ú–∞—Ä–∫–µ—Ç –ê-14", "–ú–∞—Ä–∫–µ—Ç –ê-15",
    "–ú–∞—Ä–∫–µ—Ç –ê-16", "–ú–∞—Ä–∫–µ—Ç –ê-17", "–ú–∞—Ä–∫–µ—Ç –ê-18", "–ú–∞—Ä–∫–µ—Ç –ê-19", "–ú–∞—Ä–∫–µ—Ç –ê-20",
    "–ú–∞—Ä–∫–µ—Ç –ê-21", "–ú–∞—Ä–∫–µ—Ç –ê-22", "–ú–∞—Ä–∫–µ—Ç –ê-23", "–ú–∞—Ä–∫–µ—Ç –ê-24", "–ú–∞—Ä–∫–µ—Ç –ê-25",
    "–ú–∞—Ä–∫–µ—Ç –ê-27", "–ú–∞—Ä–∫–µ—Ç –ê-28", "–ú–∞—Ä–∫–µ—Ç –ê-29", "–ú–∞—Ä–∫–µ—Ç –ê-30", "–ú–∞—Ä–∫–µ—Ç –ê-31",
    "–ú–∞—Ä–∫–µ—Ç –ê-32", "–ú–∞—Ä–∫–µ—Ç –ê-34", "–ú–∞—Ä–∫–µ—Ç –ê-35", "–ú–∞—Ä–∫–µ—Ç –ê-37",
    "–ú–∞—Ä–∫–µ—Ç –ú-02", "–ú–∞—Ä–∫–µ—Ç –ú-03", "–ú–∞—Ä–∫–µ—Ç –ú-04", "–ú–∞—Ä–∫–µ—Ç –ú-05", "–ú–∞—Ä–∫–µ—Ç –ú-06",
    "–ú–∞—Ä–∫–µ—Ç –ú-07", "–ú–∞—Ä–∫–µ—Ç –ú-08", "–ú–∞—Ä–∫–µ—Ç –ú-11", "–ú–∞—Ä–∫–µ—Ç –ú-12", "–ú–∞—Ä–∫–µ—Ç –ú-13",
    "–ú–∞—Ä–∫–µ—Ç –ú-14", "–ú–∞—Ä–∫–µ—Ç –ú-16", "–ú–∞—Ä–∫–µ—Ç –ú-18", "–ú–∞—Ä–∫–µ—Ç –ú-19", "–ú–∞—Ä–∫–µ—Ç –ú-20",
    "–ú–∞—Ä–∫–µ—Ç –ú-21", "–ú–∞—Ä–∫–µ—Ç –ú-22", "–ú–∞—Ä–∫–µ—Ç –ú-23", "–ú–∞—Ä–∫–µ—Ç –ú-25", "–ú–∞—Ä–∫–µ—Ç –ú-26",
    "–ú–∞—Ä–∫–µ—Ç –ú-27", "–ú–∞—Ä–∫–µ—Ç –ú-28", "–ú–∞—Ä–∫–µ—Ç –ú-30", "–ú–∞—Ä–∫–µ—Ç –ú-31", "–ú–∞—Ä–∫–µ—Ç –ú-32",
    "–ú–∞—Ä–∫–µ—Ç –ú-33", "–ú–∞—Ä–∫–µ—Ç –ú-34", "–ú–∞—Ä–∫–µ—Ç –ú-35", "–ú–∞—Ä–∫–µ—Ç –ú-36", "–ú–∞—Ä–∫–µ—Ç –ú-37",
    "–ú–∞—Ä–∫–µ—Ç –ú-40", "–ú–∞—Ä–∫–µ—Ç –ú-41", "–ú–∞—Ä–∫–µ—Ç –ú-42", "–ú–∞—Ä–∫–µ—Ç –ú-43", "–ú–∞—Ä–∫–µ—Ç –ú-44",
    "–ú–∞—Ä–∫–µ—Ç –ú-45", "–ú–∞—Ä–∫–µ—Ç –ú-46", "–ú–∞—Ä–∫–µ—Ç –ú-47", "–ú–∞—Ä–∫–µ—Ç –ú-48", "–ú–∞—Ä–∫–µ—Ç –ú-49",
    "–ú–∞—Ä–∫–µ—Ç –ú-50", "–ú–∞—Ä–∫–µ—Ç –ú-51", "–ú–∞—Ä–∫–µ—Ç –ú-53", "–ú–∞—Ä–∫–µ—Ç –ú-55", "–ú–∞—Ä–∫–µ—Ç –ú-56",
    "–ú–∞—Ä–∫–µ—Ç –ú-57", "–ú–∞—Ä–∫–µ—Ç –ú-58", "–ú–∞—Ä–∫–µ—Ç –ú-59", "–ú–∞—Ä–∫–µ—Ç –ú-60", "–ú–∞—Ä–∫–µ—Ç –ú-61",
    "–ú–∞—Ä–∫–µ—Ç –ú-62", "–ú–∞—Ä–∫–µ—Ç –ú-63", "–ú–∞—Ä–∫–µ—Ç –ú-64", "–ú–∞—Ä–∫–µ—Ç –ú-65", "–ú–∞—Ä–∫–µ—Ç –ú-66",
    "–ú–∞—Ä–∫–µ—Ç –ú-67", "–ú–∞—Ä–∫–µ—Ç –ú-68", "–ú–∞—Ä–∫–µ—Ç –ú-69", "–ú–∞—Ä–∫–µ—Ç –ú-70", "–ú–∞—Ä–∫–µ—Ç –ú-71",
    "–ú–∞—Ä–∫–µ—Ç –ú-72", "–ú–∞—Ä–∫–µ—Ç –ú-73", "–ú–∞—Ä–∫–µ—Ç –ú-74", "–ú–∞—Ä–∫–µ—Ç –ú-75", "–ú–∞—Ä–∫–µ—Ç –ú-76",
    "–ú–∞—Ä–∫–µ—Ç –ú-78", "–ú–∞—Ä–∫–µ—Ç –ú-79", "–ú–∞—Ä–∫–µ—Ç –ú-80", "–ú–∞—Ä–∫–µ—Ç –ú-81", "–ú–∞—Ä–∫–µ—Ç –ú-82",
    "–ú–∞—Ä–∫–µ—Ç –ú-83", "–ú–∞—Ä–∫–µ—Ç –ú-84", "–ú–∞—Ä–∫–µ—Ç –ú-85", "–ú–∞—Ä–∫–µ—Ç –ú-86", "–ú–∞—Ä–∫–µ—Ç –ú-87",
    "–ú–∞—Ä–∫–µ—Ç –ú-88", "–ú–∞—Ä–∫–µ—Ç –ú-89", "–ú–∞—Ä–∫–µ—Ç –ú-90", "–ú–∞—Ä–∫–µ—Ç –ú-91", "–ú–∞—Ä–∫–µ—Ç –ú-92",
    "–ú–∞—Ä–∫–µ—Ç –ú-93", "–ú–∞—Ä–∫–µ—Ç –ú-95", "–ú–∞—Ä–∫–µ—Ç –ú-96", "–ú–∞—Ä–∫–µ—Ç –ú-97", "–ú–∞—Ä–∫–µ—Ç –ú-98",
    "–ú–∞—Ä–∫–µ—Ç –ú-99",
    "–ú–∞—Ä–∫–µ—Ç –ú-101"
